(self["webpackChunk_coreui_coreui_free_vue_admin_template"]=self["webpackChunk_coreui_coreui_free_vue_admin_template"]||[]).push([[3090],{3339:function(e){
/*!
 * FilePondPluginFileValidateType 1.2.8
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */
(function(t,i){e.exports=i()})(0,(function(){"use strict";var e=function(e){var t=e.addFilter,i=e.utils,r=i.Type,n=i.isString,a=i.replaceInString,o=i.guesstimateMimeType,c=i.getExtensionFromFilename,u=i.getFilenameFromURL,s=function(e,t){var i=(/^[^/]+/.exec(e)||[]).pop(),r=t.slice(0,-2);return i===r},l=function(e,t){return e.some((function(e){return/\*$/.test(e)?s(t,e):e===t}))},h=function(e){var t="";if(n(e)){var i=u(e),r=c(i);r&&(t=o(r))}else t=e.type;return t},f=function(e,t,i){if(0===t.length)return!0;var r=h(e);return i?new Promise((function(n,a){i(e,r).then((function(e){l(t,e)?n():a()})).catch(a)})):l(t,r)},d=function(e){return function(t){return null!==e[t]&&(e[t]||t)}};return t("SET_ATTRIBUTE_TO_OPTION_MAP",(function(e){return Object.assign(e,{accept:"acceptedFileTypes"})})),t("ALLOW_HOPPER_ITEM",(function(e,t){var i=t.query;return!i("GET_ALLOW_FILE_TYPE_VALIDATION")||f(e,i("GET_ACCEPTED_FILE_TYPES"))})),t("LOAD_FILE",(function(e,t){var i=t.query;return new Promise((function(t,r){if(i("GET_ALLOW_FILE_TYPE_VALIDATION")){var n=i("GET_ACCEPTED_FILE_TYPES"),o=i("GET_FILE_VALIDATE_TYPE_DETECT_TYPE"),c=f(e,n,o),u=function(){var e=n.map(d(i("GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES_MAP"))).filter((function(e){return!1!==e})),t=e.filter((function(t,i){return e.indexOf(t)===i}));r({status:{main:i("GET_LABEL_FILE_TYPE_NOT_ALLOWED"),sub:a(i("GET_FILE_VALIDATE_TYPE_LABEL_EXPECTED_TYPES"),{allTypes:t.join(", "),allButLastType:t.slice(0,-1).join(", "),lastType:t[e.length-1]})}})};if("boolean"===typeof c)return c?t(e):u();c.then((function(){t(e)})).catch(u)}else t(e)}))})),{options:{allowFileTypeValidation:[!0,r.BOOLEAN],acceptedFileTypes:[[],r.ARRAY],labelFileTypeNotAllowed:["File is of invalid type",r.STRING],fileValidateTypeLabelExpectedTypes:["Expects {allButLastType} or {lastType}",r.STRING],fileValidateTypeLabelExpectedTypesMap:[{},r.OBJECT],fileValidateTypeDetectType:[null,r.FUNCTION]}}},t="undefined"!==typeof window&&"undefined"!==typeof window.document;return t&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:e})),e}))},2548:function(e,t,i){i(7658),i(6229),i(7330),i(2062),i(1439),i(7585),i(5315),
/*!
 * FilePondPluginImagePreview 4.6.11
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */
function(t,i){e.exports=i()}(0,(function(){"use strict";var e=function(e){return/^image/.test(e.type)};function t(e){this.wrapped=e}function i(e){var i,r;function n(e,t){return new Promise((function(n,o){var c={key:e,arg:t,resolve:n,reject:o,next:null};r?r=r.next=c:(i=r=c,a(e,t))}))}function a(i,r){try{var n=e[i](r),c=n.value,u=c instanceof t;Promise.resolve(u?c.wrapped:c).then((function(e){u?a("next",e):o(n.done?"return":"normal",e)}),(function(e){a("throw",e)}))}catch(s){o("throw",s)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1});break}i=i.next,i?a(i.key,i.arg):r=null}this._invoke=n,"function"!==typeof e.return&&(this.return=void 0)}"function"===typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(e){return this._invoke("next",e)},i.prototype.throw=function(e){return this._invoke("throw",e)},i.prototype.return=function(e){return this._invoke("return",e)};function r(e,t){return n(e)||a(e,t)||o()}function n(e){if(Array.isArray(e))return e}function a(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done);r=!0)if(i.push(o.value),t&&i.length===t)break}catch(u){n=!0,a=u}finally{try{r||null==c["return"]||c["return"]()}finally{if(n)throw a}}return i}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var c=function(e,t){return h(e.x*t,e.y*t)},u=function(e,t){return h(e.x+t.x,e.y+t.y)},s=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return 0===t?{x:0,y:0}:h(e.x/t,e.y/t)},l=function(e,t,i){var r=Math.cos(t),n=Math.sin(t),a=h(e.x-i.x,e.y-i.y);return h(i.x+r*a.x-n*a.y,i.y+n*a.x+r*a.y)},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return{x:e,y:t}},f=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;return"string"===typeof e?parseFloat(e)*i:"number"===typeof e?e*(r?t[r]:Math.min(t.width,t.height)):void 0},d=function(e,t,i){var r=e.borderStyle||e.lineStyle||"solid",n=e.backgroundColor||e.fontColor||"transparent",a=e.borderColor||e.lineColor||"transparent",o=f(e.borderWidth||e.lineWidth,t,i),c=e.lineCap||"round",u=e.lineJoin||"round",s="string"===typeof r?"":r.map((function(e){return f(e,t,i)})).join(","),l=e.opacity||1;return{"stroke-linecap":c,"stroke-linejoin":u,"stroke-width":o||0,"stroke-dasharray":s,stroke:a,fill:n,opacity:l}},p=function(e){return null!=e},g=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=f(e.x,t,i,"width")||f(e.left,t,i,"width"),n=f(e.y,t,i,"height")||f(e.top,t,i,"height"),a=f(e.width,t,i,"width"),o=f(e.height,t,i,"height"),c=f(e.right,t,i,"width"),u=f(e.bottom,t,i,"height");return p(n)||(n=p(o)&&p(u)?t.height-o-u:u),p(r)||(r=p(a)&&p(c)?t.width-a-c:c),p(a)||(a=p(r)&&p(c)?t.width-r-c:0),p(o)||(o=p(n)&&p(u)?t.height-n-u:0),{x:r||0,y:n||0,width:a||0,height:o||0}},m=function(e){return e.map((function(e,t){return"".concat(0===t?"M":"L"," ").concat(e.x," ").concat(e.y)})).join(" ")},E=function(e,t){return Object.keys(t).forEach((function(i){return e.setAttribute(i,t[i])}))},y="http://www.w3.org/2000/svg",_=function(e,t){var i=document.createElementNS(y,e);return t&&E(i,t),i},v=function(e){return E(e,Object.assign({},e.rect,e.styles))},w=function(e){var t=e.rect.x+.5*e.rect.width,i=e.rect.y+.5*e.rect.height,r=.5*e.rect.width,n=.5*e.rect.height;return E(e,Object.assign({cx:t,cy:i,rx:r,ry:n},e.styles))},I={contain:"xMidYMid meet",cover:"xMidYMid slice"},T=function(e,t){E(e,Object.assign({},e.rect,e.styles,{preserveAspectRatio:I[t.fit]||"none"}))},M={left:"start",center:"middle",right:"end"},x=function(e,t,i,r){var n=f(t.fontSize,i,r),a=t.fontFamily||"sans-serif",o=t.fontWeight||"normal",c=M[t.textAlign]||"start";E(e,Object.assign({},e.rect,e.styles,{"stroke-width":0,"font-weight":o,"font-size":n,"font-family":a,"text-anchor":c})),e.text!==t.text&&(e.text=t.text,e.textContent=t.text.length?t.text:" ")},A=function(e,t,i,r){E(e,Object.assign({},e.rect,e.styles,{fill:"none"}));var n=e.childNodes[0],a=e.childNodes[1],o=e.childNodes[2],h=e.rect,d={x:e.rect.x+e.rect.width,y:e.rect.y+e.rect.height};if(E(n,{x1:h.x,y1:h.y,x2:d.x,y2:d.y}),t.lineDecoration){a.style.display="none",o.style.display="none";var p=s({x:d.x-h.x,y:d.y-h.y}),g=f(.05,i,r);if(-1!==t.lineDecoration.indexOf("arrow-begin")){var m=c(p,g),y=u(h,m),_=l(h,2,y),v=l(h,-2,y);E(a,{style:"display:block;",d:"M".concat(_.x,",").concat(_.y," L").concat(h.x,",").concat(h.y," L").concat(v.x,",").concat(v.y)})}if(-1!==t.lineDecoration.indexOf("arrow-end")){var w=c(p,-g),I=u(d,w),T=l(d,2,I),M=l(d,-2,I);E(o,{style:"display:block;",d:"M".concat(T.x,",").concat(T.y," L").concat(d.x,",").concat(d.y," L").concat(M.x,",").concat(M.y)})}}},R=function(e,t,i,r){E(e,Object.assign({},e.styles,{fill:"none",d:m(t.points.map((function(e){return{x:f(e.x,i,r,"width"),y:f(e.y,i,r,"height")}})))}))},P=function(e){return function(t){return _(e,{id:t.id})}},C=function(e){var t=_("image",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return t.onload=function(){t.setAttribute("opacity",e.opacity||1)},t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.src),t},D=function(e){var t=_("g",{id:e.id,"stroke-linecap":"round","stroke-linejoin":"round"}),i=_("line");t.appendChild(i);var r=_("path");t.appendChild(r);var n=_("path");return t.appendChild(n),t},G={image:C,rect:P("rect"),ellipse:P("ellipse"),text:P("text"),path:P("path"),line:D},L={rect:v,ellipse:w,image:T,text:x,path:R,line:A},k=function(e,t){return G[e](t)},O=function(e,t,i,r,n){"path"!==t&&(e.rect=g(i,r,n)),e.styles=d(i,r,n),L[t](e,i,r,n)},V=["x","y","left","top","right","bottom","width","height"],b=function(e){return"string"===typeof e&&/%/.test(e)?parseFloat(e)/100:e},S=function(e){var t=r(e,2),i=t[0],n=t[1],a=n.points?{}:V.reduce((function(e,t){return e[t]=b(n[t]),e}),{});return[i,Object.assign({zIndex:0},n,a)]},N=function(e,t){return e[1].zIndex>t[1].zIndex?1:e[1].zIndex<t[1].zIndex?-1:0},F=function(e){return e.utils.createView({name:"image-preview-markup",tag:"svg",ignoreRect:!0,mixins:{apis:["width","height","crop","markup","resize","dirty"]},write:function(e){var t=e.root,i=e.props;if(i.dirty){var n=i.crop,a=i.resize,o=i.markup,c=i.width,u=i.height,s=n.width,l=n.height;if(a){var h=a.size,f=h&&h.width,d=h&&h.height,p=a.mode,g=a.upscale;f&&!d&&(d=f),d&&!f&&(f=d);var m=s<f&&l<d;if(!m||m&&g){var E,y=f/s,_=d/l;if("force"===p)s=f,l=d;else"cover"===p?E=Math.max(y,_):"contain"===p&&(E=Math.min(y,_)),s*=E,l*=E}}var v={width:c,height:u};t.element.setAttribute("width",v.width),t.element.setAttribute("height",v.height);var w=Math.min(c/s,u/l);t.element.innerHTML="";var I=t.query("GET_IMAGE_PREVIEW_MARKUP_FILTER");o.filter(I).map(S).sort(N).forEach((function(e){var i=r(e,2),n=i[0],a=i[1],o=k(n,a);O(o,n,a,v,w),t.element.appendChild(o)}))}}})},W=function(e,t){return{x:e,y:t}},Y=function(e,t){return e.x*t.x+e.y*t.y},q=function(e,t){return W(e.x-t.x,e.y-t.y)},z=function(e,t){return Y(q(e,t),q(e,t))},H=function(e,t){return Math.sqrt(z(e,t))},U=function(e,t){var i=e,r=1.5707963267948966,n=t,a=1.5707963267948966-t,o=Math.sin(r),c=Math.sin(n),u=Math.sin(a),s=Math.cos(a),l=i/o,h=l*c,f=l*u;return W(s*h,s*f)},X=function(e,t){var i=e.width,r=e.height,n=U(i,t),a=U(r,t),o=W(e.x+Math.abs(n.x),e.y-Math.abs(n.y)),c=W(e.x+e.width+Math.abs(a.y),e.y+Math.abs(a.x)),u=W(e.x-Math.abs(a.y),e.y+e.height-Math.abs(a.x));return{width:H(o,c),height:H(o,u)}},j=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=e.height/e.width,n=1,a=t,o=1,c=r;c>a&&(c=a,o=c/r);var u=Math.max(n/o,a/c),s=e.width/(i*u*o),l=s*t;return{width:s,height:l}},B=function(e,t,i,r){var n=r.x>.5?1-r.x:r.x,a=r.y>.5?1-r.y:r.y,o=2*n*e.width,c=2*a*e.height,u=X(t,i);return Math.max(u.width/o,u.height/c)},Z=function(e,t){var i=e.width,r=i*t;r>e.height&&(r=e.height,i=r/t);var n=.5*(e.width-i),a=.5*(e.height-r);return{x:n,y:a,width:i,height:r}},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.zoom,r=t.rotation,n=t.center,a=t.aspectRatio;a||(a=e.height/e.width);var o=j(e,a,i),c={x:.5*o.width,y:.5*o.height},u={x:0,y:0,width:o.width,height:o.height,center:c},s="undefined"===typeof t.scaleToFit||t.scaleToFit,l=B(e,Z(u,a),r,s?n:{x:.5,y:.5}),h=i*l;return{widthFloat:o.width/h,heightFloat:o.height/h,width:Math.round(o.width/h),height:Math.round(o.height/h)}},J={type:"spring",stiffness:.5,damping:.45,mass:10},$=function(e){return e.utils.createView({name:"image-bitmap",ignoreRect:!0,mixins:{styles:["scaleX","scaleY"]},create:function(e){var t=e.root,i=e.props;t.appendChild(i.image)}})},Q=function(e){return e.utils.createView({name:"image-canvas-wrapper",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ"],animations:{originX:J,originY:J,scaleX:J,scaleY:J,translateX:J,translateY:J,rotateZ:J}},create:function(t){var i=t.root,r=t.props;r.width=r.image.width,r.height=r.image.height,i.ref.bitmap=i.appendChildView(i.createChildView($(e),{image:r.image}))},write:function(e){var t=e.root,i=e.props,r=i.crop.flip,n=t.ref.bitmap;n.scaleX=r.horizontal?-1:1,n.scaleY=r.vertical?-1:1}})},ee=function(e){return e.utils.createView({name:"image-clip",tag:"div",ignoreRect:!0,mixins:{apis:["crop","markup","resize","width","height","dirty","background"],styles:["width","height","opacity"],animations:{opacity:{type:"tween",duration:250}}},didWriteView:function(e){var t=e.root,i=e.props;i.background&&(t.element.style.backgroundColor=i.background)},create:function(t){var i=t.root,r=t.props;i.ref.image=i.appendChildView(i.createChildView(Q(e),Object.assign({},r))),i.ref.createMarkup=function(){i.ref.markup||(i.ref.markup=i.appendChildView(i.createChildView(F(e),Object.assign({},r))))},i.ref.destroyMarkup=function(){i.ref.markup&&(i.removeChildView(i.ref.markup),i.ref.markup=null)};var n=i.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==n&&(i.element.dataset.transparencyIndicator="grid"===n?n:"color")},write:function(e){var t=e.root,i=e.props,r=e.shouldOptimize,n=i.crop,a=i.markup,o=i.resize,c=i.dirty,u=i.width,s=i.height;t.ref.image.crop=n;var l={x:0,y:0,width:u,height:s,center:{x:.5*u,y:.5*s}},h={width:t.ref.image.width,height:t.ref.image.height},f={x:n.center.x*h.width,y:n.center.y*h.height},d={x:l.center.x-h.width*n.center.x,y:l.center.y-h.height*n.center.y},p=2*Math.PI+n.rotation%(2*Math.PI),g=n.aspectRatio||h.height/h.width,m="undefined"===typeof n.scaleToFit||n.scaleToFit,E=B(h,Z(l,g),p,m?n.center:{x:.5,y:.5}),y=n.zoom*E;a&&a.length?(t.ref.createMarkup(),t.ref.markup.width=u,t.ref.markup.height=s,t.ref.markup.resize=o,t.ref.markup.dirty=c,t.ref.markup.markup=a,t.ref.markup.crop=K(h,n)):t.ref.markup&&t.ref.destroyMarkup();var _=t.ref.image;if(r)return _.originX=null,_.originY=null,_.translateX=null,_.translateY=null,_.rotateZ=null,_.scaleX=null,void(_.scaleY=null);_.originX=f.x,_.originY=f.y,_.translateX=d.x,_.translateY=d.y,_.rotateZ=p,_.scaleX=y,_.scaleY=y}})},te=function(e){return e.utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,mixins:{apis:["image","crop","markup","resize","dirty","background"],styles:["translateY","scaleX","scaleY","opacity"],animations:{scaleX:J,scaleY:J,translateY:J,opacity:{type:"tween",duration:400}}},create:function(t){var i=t.root,r=t.props;i.ref.clip=i.appendChildView(i.createChildView(ee(e),{id:r.id,image:r.image,crop:r.crop,markup:r.markup,resize:r.resize,dirty:r.dirty,background:r.background}))},write:function(e){var t=e.root,i=e.props,r=e.shouldOptimize,n=t.ref.clip,a=i.image,o=i.crop,c=i.markup,u=i.resize,s=i.dirty;if(n.crop=o,n.markup=c,n.resize=u,n.dirty=s,n.opacity=r?0:1,!r&&!t.rect.element.hidden){var l=a.height/a.width,h=o.aspectRatio||l,f=t.rect.inner.width,d=t.rect.inner.height,p=t.query("GET_IMAGE_PREVIEW_HEIGHT"),g=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),m=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),E=t.query("GET_PANEL_ASPECT_RATIO"),y=t.query("GET_ALLOW_MULTIPLE");E&&!y&&(p=f*E,h=E);var _=null!==p?p:Math.max(g,Math.min(f*h,m)),v=_/h;v>f&&(v=f,_=v*h),_>d&&(_=d,v=d/h),n.width=v,n.height=_}}})},ie='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n    <defs>\n        <radialGradient id="gradient-__UID__" cx=".5" cy="1.25" r="1.15">\n            <stop offset=\'50%\' stop-color=\'#000000\'/>\n            <stop offset=\'56%\' stop-color=\'#0a0a0a\'/>\n            <stop offset=\'63%\' stop-color=\'#262626\'/>\n            <stop offset=\'69%\' stop-color=\'#4f4f4f\'/>\n            <stop offset=\'75%\' stop-color=\'#808080\'/>\n            <stop offset=\'81%\' stop-color=\'#b1b1b1\'/>\n            <stop offset=\'88%\' stop-color=\'#dadada\'/>\n            <stop offset=\'94%\' stop-color=\'#f6f6f6\'/>\n            <stop offset=\'100%\' stop-color=\'#ffffff\'/>\n        </radialGradient>\n        <mask id="mask-__UID__">\n            <rect x="0" y="0" width="500" height="200" fill="url(#gradient-__UID__)"></rect>\n        </mask>\n    </defs>\n    <rect x="0" width="500" height="200" fill="currentColor" mask="url(#mask-__UID__)"></rect>\n</svg>',re=0,ne=function(e){return e.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:function(e){var t=e.root,i=e.props,r=ie;if(document.querySelector("base")){var n=new URL(window.location.href.replace(window.location.hash,"")).href;r=r.replace(/url\(\#/g,"url("+n+"#")}re++,t.element.classList.add("filepond--image-preview-overlay-".concat(i.status)),t.element.innerHTML=r.replace(/__UID__/g,re)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}})},ae=function(){self.onmessage=function(e){createImageBitmap(e.data.message.file).then((function(t){self.postMessage({id:e.data.id,message:t},[t])}))}},oe=function(){self.onmessage=function(e){for(var t=e.data.message.imageData,i=e.data.message.colorMatrix,r=t.data,n=r.length,a=i[0],o=i[1],c=i[2],u=i[3],s=i[4],l=i[5],h=i[6],f=i[7],d=i[8],p=i[9],g=i[10],m=i[11],E=i[12],y=i[13],_=i[14],v=i[15],w=i[16],I=i[17],T=i[18],M=i[19],x=0,A=0,R=0,P=0,C=0;x<n;x+=4)A=r[x]/255,R=r[x+1]/255,P=r[x+2]/255,C=r[x+3]/255,r[x]=Math.max(0,Math.min(255*(A*a+R*o+P*c+C*u+s),255)),r[x+1]=Math.max(0,Math.min(255*(A*l+R*h+P*f+C*d+p),255)),r[x+2]=Math.max(0,Math.min(255*(A*g+R*m+P*E+C*y+_),255)),r[x+3]=Math.max(0,Math.min(255*(A*v+R*w+P*I+C*T+M),255));self.postMessage({id:e.data.id,message:t},[t.data.buffer])}},ce=function(e,t){var i=new Image;i.onload=function(){var e=i.naturalWidth,r=i.naturalHeight;i=null,t(e,r)},i.src=e},ue={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},se=function(e,t,i,r){-1!==r&&e.transform.apply(e,ue[r](t,i))},le=function(e,t,i,r){t=Math.round(t),i=Math.round(i);var n=document.createElement("canvas");n.width=t,n.height=i;var a=n.getContext("2d");if(r>=5&&r<=8){var o=[i,t];t=o[0],i=o[1]}return se(a,t,i,r),a.drawImage(e,0,0,t,i),n},he=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},fe=10,de=10,pe=function(e){var t=Math.min(fe/e.width,de/e.height),i=document.createElement("canvas"),r=i.getContext("2d"),n=i.width=Math.ceil(e.width*t),a=i.height=Math.ceil(e.height*t);r.drawImage(e,0,0,n,a);var o=null;try{o=r.getImageData(0,0,n,a).data}catch(f){return null}for(var c=o.length,u=0,s=0,l=0,h=0;h<c;h+=4)u+=o[h]*o[h],s+=o[h+1]*o[h+1],l+=o[h+2]*o[h+2];return u=ge(u,c),s=ge(s,c),l=ge(l,c),{r:u,g:s,b:l}},ge=function(e,t){return Math.floor(Math.sqrt(e/(t/4)))},me=function(e,t){t=t||document.createElement("canvas"),t.width=e.width,t.height=e.height;var i=t.getContext("2d");return i.drawImage(e,0,0),t},Ee=function(e){var t;try{t=new ImageData(e.width,e.height)}catch(n){var i=document.createElement("canvas"),r=i.getContext("2d");t=r.createImageData(e.width,e.height)}return t.data.set(new Uint8ClampedArray(e.data)),t},ye=function(e){return new Promise((function(t,i){var r=new Image;r.crossOrigin="Anonymous",r.onload=function(){t(r)},r.onerror=function(e){i(e)},r.src=e}))},_e=function(e){var t=ne(e),i=te(e),r=e.utils.createWorker,n=function(e,t,i){return new Promise((function(n){e.ref.imageData||(e.ref.imageData=i.getContext("2d").getImageData(0,0,i.width,i.height));var a=Ee(e.ref.imageData);if(!t||20!==t.length)return i.getContext("2d").putImageData(a,0,0),n();var o=r(oe);o.post({imageData:a,colorMatrix:t},(function(e){i.getContext("2d").putImageData(e,0,0),o.terminate(),n()}),[a.data.buffer])}))},a=function(e,t){e.removeChildView(t),t.image.width=1,t.image.height=1,t._destroy()},o=function(e){var t=e.root,i=t.ref.images.shift();return i.opacity=0,i.translateY=-15,t.ref.imageViewBin.push(i),i},c=function(e){var t=e.root,r=e.props,n=e.image,a=r.id,o=t.query("GET_ITEM",{id:a});if(o){var c,u,s=o.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},l=t.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR"),h=!1;t.query("GET_IMAGE_PREVIEW_MARKUP_SHOW")&&(c=o.getMetadata("markup")||[],u=o.getMetadata("resize"),h=!0);var f=t.appendChildView(t.createChildView(i,{id:a,image:n,crop:s,resize:u,markup:c,dirty:h,background:l,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),t.childViews.length);t.ref.images.push(f),f.opacity=1,f.scaleX=1,f.scaleY=1,f.translateY=0,setTimeout((function(){t.dispatch("DID_IMAGE_PREVIEW_SHOW",{id:a})}),250)}},u=function(e){var t=e.root,i=e.props,r=t.query("GET_ITEM",{id:i.id});if(r){var n=t.ref.images[t.ref.images.length-1];n.crop=r.getMetadata("crop"),n.background=t.query("GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR"),t.query("GET_IMAGE_PREVIEW_MARKUP_SHOW")&&(n.dirty=!0,n.resize=r.getMetadata("resize"),n.markup=r.getMetadata("markup"))}},s=function(e){var t=e.root,i=e.props,r=e.action;if(/crop|filter|markup|resize/.test(r.change.key)&&t.ref.images.length){var a=t.query("GET_ITEM",{id:i.id});if(a)if(/filter/.test(r.change.key)){var s=t.ref.images[t.ref.images.length-1];n(t,r.change.value,s.image)}else if(/crop|markup|resize/.test(r.change.key)){var l=a.getMetadata("crop"),h=t.ref.images[t.ref.images.length-1];if(l&&l.aspectRatio&&h.crop&&h.crop.aspectRatio&&Math.abs(l.aspectRatio-h.crop.aspectRatio)>1e-5){var f=o({root:t});c({root:t,props:i,image:me(f.image)})}else u({root:t,props:i})}}},l=function(e){var t=window.navigator.userAgent,i=t.match(/Firefox\/([0-9]+)\./),r=i?parseInt(i[1]):null;return!(r<=58)&&("createImageBitmap"in window&&he(e))},h=function(e){var t=e.root,i=e.props,r=i.id,n=t.query("GET_ITEM",r);if(n){var a=URL.createObjectURL(n.file);ce(a,(function(e,i){t.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:r,width:e,height:i})}))}},f=function(e){var t=e.root,i=e.props,a=i.id,o=t.query("GET_ITEM",a);if(o){var u=URL.createObjectURL(o.file),s=function(){ye(u).then(h)},h=function(e){URL.revokeObjectURL(u);var r=o.getMetadata("exif")||{},a=r.orientation||-1,s=e.width,l=e.height;if(s&&l){if(a>=5&&a<=8){var h=[l,s];s=h[0],l=h[1]}var f=Math.max(1,.75*window.devicePixelRatio),d=t.query("GET_IMAGE_PREVIEW_ZOOM_FACTOR"),p=d*f,g=l/s,m=t.rect.element.width,E=t.rect.element.height,y=m,_=y*g;g>1?(y=Math.min(s,m*p),_=y*g):(_=Math.min(l,E*p),y=_/g);var v=le(e,y,_,a),w=function(){var r=t.query("GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR")?pe(data):null;o.setMetadata("color",r,!0),"close"in e&&e.close(),t.ref.overlayShadow.opacity=1,c({root:t,props:i,image:v})},I=o.getMetadata("filter");I?n(t,I,v).then(w):w()}};if(l(o.file)){var f=r(ae);f.post({file:o.file},(function(e){f.terminate(),e?h(e):s()}))}else s()}},d=function(e){var t=e.root,i=t.ref.images[t.ref.images.length-1];i.translateY=0,i.scaleX=1,i.scaleY=1,i.opacity=1},p=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},g=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1},m=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},E=function(e){var i=e.root;i.ref.images=[],i.ref.imageData=null,i.ref.imageViewBin=[],i.ref.overlayShadow=i.appendChildView(i.createChildView(t,{opacity:0,status:"idle"})),i.ref.overlaySuccess=i.appendChildView(i.createChildView(t,{opacity:0,status:"success"})),i.ref.overlayError=i.appendChildView(i.createChildView(t,{opacity:0,status:"failure"}))};return e.utils.createView({name:"image-preview-wrapper",create:E,styles:["height"],apis:["height"],destroy:function(e){var t=e.root;t.ref.images.forEach((function(e){e.image.width=1,e.image.height=1}))},didWriteView:function(e){var t=e.root;t.ref.images.forEach((function(e){e.dirty=!1}))},write:e.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:d,DID_IMAGE_PREVIEW_CONTAINER_CREATE:h,DID_FINISH_CALCULATE_PREVIEWSIZE:f,DID_UPDATE_ITEM_METADATA:s,DID_THROW_ITEM_LOAD_ERROR:g,DID_THROW_ITEM_PROCESSING_ERROR:g,DID_THROW_ITEM_INVALID:g,DID_COMPLETE_ITEM_PROCESSING:m,DID_START_ITEM_PROCESSING:p,DID_REVERT_ITEM_PROCESSING:p},(function(e){var t=e.root,i=t.ref.imageViewBin.filter((function(e){return 0===e.opacity}));t.ref.imageViewBin=t.ref.imageViewBin.filter((function(e){return e.opacity>0})),i.forEach((function(e){return a(t,e)})),i.length=0}))})},ve=function(t){var i=t.addFilter,r=t.utils,n=r.Type,a=r.createRoute,o=r.isFile,c=_e(t);return i("CREATE_VIEW",(function(t){var i=t.is,r=t.view,n=t.query;if(i("file")&&n("GET_ALLOW_IMAGE_PREVIEW")){var u=function(t){var i=t.root,a=t.props,u=a.id,s=n("GET_ITEM",u);if(s&&o(s.file)&&!s.archived){var l=s.file;if(e(l)&&n("GET_IMAGE_PREVIEW_FILTER_ITEM")(s)){var h="createImageBitmap"in(window||{}),f=n("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");if(!(!h&&f&&l.size>f)){i.ref.imagePreview=r.appendChildView(r.createChildView(c,{id:u}));var d=i.query("GET_IMAGE_PREVIEW_HEIGHT");d&&i.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:s.id,height:d});var p=!h&&l.size>n("GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE");i.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:u},p)}}}},s=function(e,t){if(e.ref.imagePreview){var i=t.id,r=e.query("GET_ITEM",{id:i});if(r){var n=e.query("GET_PANEL_ASPECT_RATIO"),a=e.query("GET_ITEM_PANEL_ASPECT_RATIO"),o=e.query("GET_IMAGE_PREVIEW_HEIGHT");if(!(n||a||o)){var c=e.ref,u=c.imageWidth,s=c.imageHeight;if(u&&s){var l=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),h=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),f=r.getMetadata("exif")||{},d=f.orientation||-1;if(d>=5&&d<=8){var p=[s,u];u=p[0],s=p[1]}if(!he(r.file)||e.query("GET_IMAGE_PREVIEW_UPSCALE")){var g=2048/u;u*=g,s*=g}var m=s/u,E=(r.getMetadata("crop")||{}).aspectRatio||m,y=Math.max(l,Math.min(s,h)),_=e.rect.element.width,v=Math.min(_*E,y);e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:r.id,height:v})}}}}},l=function(e){var t=e.root;t.ref.shouldRescale=!0},h=function(e){var t=e.root,i=e.action;"crop"===i.change.key&&(t.ref.shouldRescale=!0)},f=function(e){var t=e.root,i=e.action;t.ref.imageWidth=i.width,t.ref.imageHeight=i.height,t.ref.shouldRescale=!0,t.ref.shouldDrawPreview=!0,t.dispatch("KICK")};r.registerWriter(a({DID_RESIZE_ROOT:l,DID_STOP_RESIZE:l,DID_LOAD_ITEM:u,DID_IMAGE_PREVIEW_CALCULATE_SIZE:f,DID_UPDATE_ITEM_METADATA:h},(function(e){var t=e.root,i=e.props;t.ref.imagePreview&&(t.rect.element.hidden||(t.ref.shouldRescale&&(s(t,i),t.ref.shouldRescale=!1),t.ref.shouldDrawPreview&&(requestAnimationFrame((function(){requestAnimationFrame((function(){t.dispatch("DID_FINISH_CALCULATE_PREVIEWSIZE",{id:i.id})}))})),t.ref.shouldDrawPreview=!1)))})))}})),{options:{allowImagePreview:[!0,n.BOOLEAN],imagePreviewFilterItem:[function(){return!0},n.FUNCTION],imagePreviewHeight:[null,n.INT],imagePreviewMinHeight:[44,n.INT],imagePreviewMaxHeight:[256,n.INT],imagePreviewMaxFileSize:[null,n.INT],imagePreviewZoomFactor:[2,n.INT],imagePreviewUpscale:[!1,n.BOOLEAN],imagePreviewMaxInstantPreviewFileSize:[1e6,n.INT],imagePreviewTransparencyIndicator:[null,n.STRING],imagePreviewCalculateAverageImageColor:[!1,n.BOOLEAN],imagePreviewMarkupShow:[!0,n.BOOLEAN],imagePreviewMarkupFilter:[function(){return!0},n.FUNCTION]}}},we="undefined"!==typeof window&&"undefined"!==typeof window.document;return we&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:ve})),ve}))}}]);
//# sourceMappingURL=3090.6d3bd935.js.map